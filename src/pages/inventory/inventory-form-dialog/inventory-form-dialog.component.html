<p-dialog
  [(visible)]="isOpen"
  [modal]="true"
  [dismissableMask]="true"
  header="Movimentar Estoque"
  [style]="{ width: '900px' }"
  [draggable]="false"
>
  @if (isOpen) {
  <form
    class="grid grid-cols-1 sm:grid-cols-2 gap-4"
    [formGroup]="form"
    (submit)="handleSubmit(form)"
  >
    <div class="sm:col-span-2">
      <label> Tipo </label>
      <input type="hidden" formControlName="type" />
      <div class="flex flex-wrap gap-4 mt-3">
        <div class="flex items-center">
          <p-radiobutton
            formControlName="type"
            value="IN"
            inputId="strock_in"
            (onClick)="service.onTypeChange($event, form)"
          />
          <label for="strock_in" class="ml-2 mb-0">Entrada</label>
        </div>

        <div class="flex items-center">
          <p-radiobutton
            formControlName="type"
            value="OUT"
            inputId="stock_out"
            (onClick)="service.onTypeChange($event, form)"
          />
          <label for="stock_out" class="ml-2 mb-0"> Saída </label>
        </div>

        <div class="flex items-center">
          <p-radiobutton
            formControlName="type"
            value="TRANSFER"
            inputId="transfer"
            (onClick)="service.onTypeChange($event, form)"
          />
          <label for="transfer" class="ml-2 mb-0"> Transferência </label>
        </div>
      </div>
    </div>
    <div class="col-span-1">
      <label for="origin"> Origem </label>
      <p-select
        appendTo="body"
        [options]="(inventories | async)!"
        formControlName="inventory_origin_id"
        inputId="origin"
        optionLabel="type"
        optionValue="id"
        [filter]="true"
        (onChange)="service.onOriginChange($event)"
      />
    </div>
    <div class="col-span-1">
      <label for="destination"> Destino </label>
      <p-select
        appendTo="body"
        [options]="(inventories | async)!"
        formControlName="inventory_destination_id"
        inputId="destination"
        optionLabel="type"
        optionValue="id"
        [filter]="true"
      />
    </div>
    <div class="sm:col-span-1">
      <button
        type="button"
        pButton
        icon="pi pi-plus"
        size="small"
        severity="contrast"
        (click)="service.addSku(form)"
      >
        Adicionar Produto
      </button>
    </div>
    <div class="col-span-2 grid grid-cols-subgrid gap-4 skus-container">
      <div
        *ngFor="let sku of service.getSkus(form).controls; let i = index"
        class="col-span-2"
        formArrayName="skus"
      >
        <div class="grid grid-flow-col grid-cols-4 gap-4" [formGroupName]="i">
          <div class="sm:col-span-full">
            <p-select
              placeholder="Produto"
              [options]="(allProducts | async)!"
              [filter]="true"
              formControlName="sku_id"
              inputId="product"
              appendTo="body"
              optionLabel="product_name"
              optionValue="sku_id"
              required
            >
              <ng-template let-product #item>
                <div>
                  <div>{{ product.product_name }}</div>
                  <small> Código: {{ product.sku_code }} </small> <br />
                  <small> Estoque: {{ product.inventory_type }} </small> <br />
                  <small> Usuário: {{ product.user_name }} </small> <br />
                  <small> Quantidade: {{ product.quantity }} </small>
                </div>
              </ng-template>
            </p-select>
          </div>
          <div class="sm:col-span-1">
            <p-inputNumber
              placeholder="Quantidade"
              formControlName="quantity"
              inputId="sku-quantity"
              required
              min="0"
            />
          </div>
          <div class="sm:col-span-1 flex items-start">
            <button
              type="button"
              pButton
              icon="pi pi-trash"
              size="small"
              severity="danger"
              [disabled]="i == 0"
              (click)="service.removeSku(form, i)"
            ></button>
          </div>
        </div>
      </div>
    </div>
    <div class="sm:col-span-2">
      <label for="reason"> Motivo </label>
      <textarea
        pTextarea
        formControlName="justification"
        inputId="reason"
      ></textarea>
    </div>

    <div class="sm:col-span-2">
      <button type="submit" pButton fluid [disabled]="isLoading">
        Adicionar
      </button>
    </div>
  </form>
  }
</p-dialog>
